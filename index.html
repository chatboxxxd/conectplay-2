<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Programa de Afiliados ConectPlay</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
  h1, h2 { color: #0073e6; }
  label { display: block; margin-top: 10px; }
  input[type=text] { padding: 8px; width: 250px; }
  button { margin-top: 15px; padding: 10px 15px; background: #0073e6; color: white; border: none; cursor: pointer; }
  button:hover { background: #005bb5; }
  #ranking { margin-top: 30px; }
  table { border-collapse: collapse; width: 100%; max-width: 600px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { background-color: #0073e6; color: white; }
  footer { margin-top: 40px; font-size: 0.9em; color: #666; }
</style>
</head>
<body>

<h1>Programa de Afiliados ConectPlay</h1>

<section>
  <h2>Gerar seu link de indicação</h2>
  <label for="affiliateName">Seu apelido (sem espaços):</label>
  <input type="text" id="affiliateName" placeholder="Ex: joaosilva" />

  <button onclick="gerarLink()">Gerar Link</button>

  <p id="linkGerado" style="margin-top: 10px; font-weight: bold; color: green;"></p>
</section>

<section>
  <h2>Planos disponíveis</h2>
  <button onclick="abrirWhatsApp('15 dias - R$14,99')">15 dias - R$14,99</button>
  <button onclick="abrirWhatsApp('Mensal - R$20,99 (1 acesso)')">Mensal - R$20,99 (1 acesso)</button>
  <button onclick="abrirWhatsApp('Mensal - R$25,99 (2 acessos)')">Mensal - R$25,99 (2 acessos)</button>
  <button onclick="abrirWhatsApp('Bimestral - R$41,99 (1 acesso)')">Bimestral - R$41,99 (1 acesso)</button>
  <button onclick="abrirWhatsApp('Bimestral - R$43,99 (2 acessos)')">Bimestral - R$43,99 (2 acessos)</button>
  <button onclick="abrirWhatsApp('Trimestral - R$74,99 (1 acesso)')">Trimestral - R$74,99 (1 acesso)</button>
  <button onclick="abrirWhatsApp('Trimestral - R$76,99 (2 acessos)')">Trimestral - R$76,99 (2 acessos)</button>
  <button onclick="abrirWhatsApp('Semestral - R$149,99 (1 acesso)')">Semestral - R$149,99 (1 acesso)</button>
  <button onclick="abrirWhatsApp('Semestral - R$153,99 (2 acessos)')">Semestral - R$153,99 (2 acessos)</button>
  <button onclick="abrirWhatsApp('Anual - R$297,99 (1 acesso)')">Anual - R$297,99 (1 acesso)</button>
  <button onclick="abrirWhatsApp('Anual - R$299,99 (2 acessos)')">Anual - R$299,99 (2 acessos)</button>
</section>

<section>
  <h2>Seu resumo de vendas e comissão</h2>
  <label for="searchAffiliate">Digite seu apelido para ver seu total de vendas e comissão:</label>
  <input type="text" id="searchAffiliate" placeholder="Ex: joaosilva" />
  <button onclick="mostrarResumo()">Mostrar Resumo</button>

  <div id="resumo" style="margin-top: 15px; font-weight: bold;"></div>
</section>

<section id="ranking">
  <h2>Top Afiliados (Ranking)</h2>
  <table id="rankingTable">
    <thead>
      <tr><th>Posição</th><th>Apelido</th><th>Total de Vendas</th><th>Comissão por Venda (R$)</th><th>Total Ganho (R$)</th></tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</section>

<footer>
  <p>© 2025 ConectPlay. Todos os direitos reservados.</p>
</footer>

<script>
  const SCRIPT_URL = 'COLE_AQUI_A_URL_DO_SEU_SCRIPT_GAS';

  function gerarLink() {
    const affiliate = document.getElementById('affiliateName').value.trim();
    if(!affiliate){
      alert('Por favor, insira seu apelido.');
      return;
    }
    // Link para vender planos pelo WhatsApp (você pode ajustar o número e mensagem padrão)
    const baseLink = `https://wa.me/557791986049?text=Olá,%20quero%20assinar%20um%20plano,%20meu%20indicação%20é%20${affiliate}`;
    document.getElementById('linkGerado').textContent = `Seu link de indicação: ${baseLink}`;
  }

  function abrirWhatsApp(plano) {
    const affiliate = document.getElementById('affiliateName').value.trim();
    if(!affiliate){
      alert('Para escolher um plano, primeiro gere seu link inserindo seu apelido.');
      return;
    }
    const msg = encodeURIComponent(`Olá, quero assinar o plano: ${plano}. Indicação: ${affiliate}`);
    const url = `https://wa.me/557791986049?text=${msg}`;
    window.open(url, '_blank');
  }

  async function mostrarResumo() {
    const affiliate = document.getElementById('searchAffiliate').value.trim();
    if(!affiliate){
      alert('Digite seu apelido para consultar o resumo.');
      return;
    }

    try {
      const res = await fetch(`${SCRIPT_URL}?acao=getSales&affiliate=${affiliate}`);
      const data = await res.json();
      const vendas = data.totalSales || 0;

      // Defina sua regra de comissão por venda aqui:
      let comissaoPorVenda = 7; // padrão
      if(vendas > 100 && vendas <= 300) comissaoPorVenda = 8;
      else if(vendas > 300) comissaoPorVenda = 9;

      const totalGanho = vendas * comissaoPorVenda;

      document.getElementById('resumo').innerHTML = 
        `Olá, <b>${affiliate}</b>!<br>` +
        `Você fez <b>${vendas}</b> vendas.<br>` +
        `Sua comissão por venda é R$ <b>${comissaoPorVenda.toFixed(2)}</b>.<br>` +
        `Você já ganhou R$ <b>${totalGanho.toFixed(2)}</b>.`;
    } catch(err) {
      alert('Erro ao buscar dados. Tente novamente.');
    }
  }

  async function carregarRanking() {
    try {
      const res = await fetch(`${SCRIPT_URL}?acao=getRanking`);
      const ranking = await res.json();

      const tbody = document.querySelector('#rankingTable tbody');
      tbody.innerHTML = '';

      ranking.forEach((item, index) => {
        const vendas = item.sales;
        let comissaoPorVenda = 7;
        if(vendas > 100 && vendas <= 300) comissaoPorVenda = 8;
        else if(vendas > 300) comissaoPorVenda = 9;

        const totalGanho = vendas * comissaoPorVenda;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index+1}</td>
          <td>${item.affiliate}</td>
          <td>${vendas}</td>
          <td>R$ ${comissaoPorVenda.toFixed(2)}</td>
          <td>R$ ${totalGanho.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch(err) {
      console.error('Erro ao carregar ranking:', err);
    }
  }

  // Carrega ranking ao abrir a página
  carregarRanking();
</script>

</body>
</html>
