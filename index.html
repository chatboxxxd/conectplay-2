<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ConectPlay - Afiliados</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
    color: white;
    margin: 0; padding: 0 10px 40px;
    text-align: center;
  }
  header {
    padding: 20px 0;
  }
  header img {
    max-width: 250px;
  }
  section {
    max-width: 500px;
    margin: 20px auto;
    background: rgba(255 255 255 / 0.05);
    border-radius: 10px;
    padding: 15px;
  }
  h2 {
    color: #00ff88;
    margin-bottom: 15px;
  }
  input[type=text], select {
    width: 90%;
    padding: 10px;
    border-radius: 6px;
    border: none;
    margin: 10px 0;
    font-size: 16px;
  }
  button {
    background: #00ff88;
    border: none;
    border-radius: 6px;
    color: black;
    font-weight: bold;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #00cc6a;
  }
  .planos-list {
    text-align: left;
  }
  .plano-item {
    background: #111;
    margin: 10px 0;
    padding: 12px 15px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .plano-item button {
    padding: 8px 12px;
    font-size: 14px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #222;
    padding: 8px;
  }
  th {
    background: #00ff88;
    color: black;
  }
  footer {
    margin-top: 40px;
    font-size: 14px;
    color: #666;
  }
  footer a {
    color: #00ff88;
    text-decoration: none;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<header>
  <img src="https://via.placeholder.com/250x90?text=ConectPlay" alt="Logo ConectPlay" />
</header>

<section>
  <h2>Registrar Venda</h2>
  <form id="saleForm">
    <input type="text" name="apelido" placeholder="Apelido do Afiliado" required />
    <input type="text" name="cliente" placeholder="Nome do Cliente" required />
    <select name="plano" required>
      <option value="">Selecione o Plano</option>
      <option value="15 dias">15 dias - R$14,99</option>
      <option value="Mensal">Mensal - R$20,99 (1 acesso)</option>
      <option value="Mensal 2 acessos">Mensal - R$25,99 (2 acessos)</option>
      <option value="Bimestral">Bimestral - R$41,99 (1 acesso)</option>
      <option value="Bimestral 2 acessos">Bimestral - R$43,99 (2 acessos)</option>
      <option value="Trimestral">Trimestral - R$74,99 (1 acesso)</option>
      <option value="Trimestral 2 acessos">Trimestral - R$76,99 (2 acessos)</option>
      <option value="Semestral">Semestral - R$149,99 (1 acesso)</option>
      <option value="Semestral 2 acessos">Semestral - R$153,99 (2 acessos)</option>
      <option value="Anual">Anual - R$297,99 (1 acesso)</option>
      <option value="Anual 2 acessos">Anual - R$299,99 (2 acessos)</option>
    </select>
    <button type="submit">Registrar Venda</button>
  </form>
</section>

<section>
  <h2>Planos Disponíveis</h2>
  <div class="planos-list">
    <div class="plano-item">
      <div>15 dias - R$14,99</div>
      <button onclick="abrirWhatsApp('15 dias - R$14,99')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Mensal - R$20,99 (1 acesso)</div>
      <button onclick="abrirWhatsApp('Mensal - R$20,99 (1 acesso)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Mensal - R$25,99 (2 acessos)</div>
      <button onclick="abrirWhatsApp('Mensal - R$25,99 (2 acessos)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Bimestral - R$41,99 (1 acesso)</div>
      <button onclick="abrirWhatsApp('Bimestral - R$41,99 (1 acesso)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Bimestral - R$43,99 (2 acessos)</div>
      <button onclick="abrirWhatsApp('Bimestral - R$43,99 (2 acessos)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Trimestral - R$74,99 (1 acesso)</div>
      <button onclick="abrirWhatsApp('Trimestral - R$74,99 (1 acesso)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Trimestral - R$76,99 (2 acessos)</div>
      <button onclick="abrirWhatsApp('Trimestral - R$76,99 (2 acessos)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Semestral - R$149,99 (1 acesso)</div>
      <button onclick="abrirWhatsApp('Semestral - R$149,99 (1 acesso)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Semestral - R$153,99 (2 acessos)</div>
      <button onclick="abrirWhatsApp('Semestral - R$153,99 (2 acessos)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Anual - R$297,99 (1 acesso)</div>
      <button onclick="abrirWhatsApp('Anual - R$297,99 (1 acesso)')">Comprar</button>
    </div>
    <div class="plano-item">
      <div>Anual - R$299,99 (2 acessos)</div>
      <button onclick="abrirWhatsApp('Anual - R$299,99 (2 acessos)')">Comprar</button>
    </div>
  </div>
</section>

<section>
  <h2>Ranking de Afiliados</h2>
  <table>
    <thead>
      <tr><th>Afiliado</th><th>Vendas</th><th>Comissão</th></tr>
    </thead>
    <tbody id="rankingBody">
      <tr><td colspan="3">Carregando...</td></tr>
    </tbody>
  </table>
</section>

<footer>
  <p>© 2025 ConectPlay. Todos os direitos reservados. <a href="#">Termos de Uso</a> | <a href="#">Política de Privacidade</a></p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzelYH4nP-xEd9i5NXOzWYmw3URHDe9dRnIhOE10aJ7H6THkvNVnBcSDhCt__-iBQX4BQ/exec';
  const urlCsv = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRVxgmYQsCQMXj4hycv10FMS8vNm1CF3EXgbyz2yVE-_ljhsPMmv0HOppUlYnMUejkuVcErojpLchgF/pub?output=csv';

  // Enviar formulário para Google Sheets via Apps Script
  document.getElementById('saleForm').addEventListener('submit', e => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);

    fetch(scriptURL, {
      method: 'POST',
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if(data.result === 'success') {
        alert('Venda registrada com sucesso!');
        form.reset();
        carregarRanking(); // Atualiza ranking
      } else {
        alert('Erro ao registrar: ' + (data.message || 'Erro desconhecido'));
      }
    })
    .catch(() => alert('Erro de comunicação'));
  });

  // Abrir WhatsApp com mensagem pronta
  function abrirWhatsApp(plano) {
    const numero = '557791986049';
    const msg = encodeURIComponent(`Olá, quero comprar o plano ${plano} pelo ConectPlay.`);
    const url = `https://wa.me/${numero}?text=${msg}`;
    window.open(url, '_blank');
  }

  // Carregar ranking da planilha CSV, agrupar por Apelido
  function carregarRanking() {
    Papa.parse(urlCsv, {
      download: true,
      header: true,
      complete: function(results) {
        const tbody = document.getElementById('rankingBody');
        if(results.errors.length) {
          tbody.innerHTML = '<tr><td colspan="3">Erro ao carregar ranking.</td></tr>';
          console.error(results.errors);
          return;
        }

        const vendas = results.data;
        const ranking = {};

        vendas.forEach(row => {
          const apelido = row['Apelido']?.trim() || 'Sem Apelido';
          if (!ranking[apelido]) ranking[apelido] = { vendas: 0 };
          ranking[apelido].vendas++;
        });

        const rankingArray = Object.entries(ranking)
          .map(([apelido, dados]) => ({ apelido, vendas: dados.vendas }))
          .sort((a,b) => b.vendas - a.vendas);

        tbody.innerHTML = '';
        rankingArray.forEach(item => {
          tbody.innerHTML += `
            <tr>
              <td>${item.apelido}</td>
              <td>${item.vendas}</td>
              <td>R$ 0,00</td>
            </tr>
          `;
        });
      }
    });
  }

  // Carrega ranking ao abrir página
  carregarRanking();
</script>

</body>
</html>
