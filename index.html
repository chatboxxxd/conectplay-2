<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ConectPlay – Conectando você ao melhor do entretenimento!</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#3a0ca3; --bg2:#4361ee; --card:rgba(255,255,255,.08);
      --text:#fff; --muted:rgba(255,255,255,.8); --cta:#10b981;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:linear-gradient(135deg,var(--bg1),var(--bg2)) fixed;
    }
    a{color:#fff}
    header{padding:24px 16px; text-align:center}
    header img{max-width:160px; height:auto}
    h1{margin:12px 0 6px; font-size:28px}
    .slogan{margin:0; color:var(--muted)}
    .container{max-width:1000px; margin:0 auto; padding:12px 16px 40px}
    .section{background:var(--card); padding:18px; border-radius:16px; backdrop-filter:blur(6px); margin:14px 0}
    .section h2{margin:0 0 12px; font-size:20px}
    .row{display:grid; gap:12px}
    @media(min-width:720px){ .row{grid-template-columns:repeat(2,1fr)} }
    @media(min-width:980px){ .plans{grid-template-columns:repeat(3,1fr)} }

    /* Afiliado */
    .aff-box label{display:block; margin:8px 0 6px; font-weight:600}
    .input, .btn{width:100%; padding:12px 14px; border-radius:10px; border:0; font:inherit}
    .input{background:#fff; color:#111; margin-bottom:10px}
    .btn{cursor:pointer; font-weight:700}
    .btn-primary{background:var(--cta); color:#083b2e}
    .btn-outline{background:transparent; color:#fff; border:1.5px solid rgba(255,255,255,.35)}
    .mini{font-size:14px; color:var(--muted)}
    .aff-result a{color:#fff; word-break:break-all}
    .topbar{background:rgba(0,0,0,.25); padding:8px 12px; text-align:center; font-size:14px; border-radius:10px; margin-bottom:10px}

    /* Planos */
    .plans{display:grid; gap:14px}
    .plan{background:var(--card); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:16px}
    .plan h3{margin:0 0 6px}
    .price{font-size:22px; font-weight:700; margin:6px 0 10px}
    .features{list-style:none; padding:0; margin:0 0 12px}
    .features li{margin:6px 0; color:var(--muted)}
    .plan .btn{margin-top:6px}

    /* Tabela afiliados */
    table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:12px}
    th,td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.16); text-align:left}
    th{background:rgba(0,0,0,.25)}
    tr:hover{background:rgba(255,255,255,.06)}

    footer{padding:24px 16px; text-align:center; color:var(--muted)}
    footer a{text-decoration:underline}
  </style>
</head>
<body>
  <header>
    <!-- LOGO dentro da pasta images/ -->
    <img src="images/logo-conectplay.png" alt="ConectPlay">
    <h1>ConectPlay</h1>
    <p class="slogan">Conectando você ao melhor do entretenimento!</p>
  </header>

  <div class="container">

    <!-- Mostra afiliado ativo se acessar com ?apelido= -->
    <div id="affBar" class="topbar" style="display:none"></div>

    <!-- GERADOR DE LINK DO AFILIADO (parte de cima) -->
    <section class="section">
      <h2>Seu link de Afiliado</h2>
      <div class="row">
        <div class="aff-box">
          <label for="apelido">Apelido do afiliado</label>
          <input id="apelido" class="input" placeholder="Ex: joaosilva">
          <button class="btn btn-primary" onclick="gerarLinks()">Gerar meus links</button>
          <p class="mini">Compartilhe o link do site com <code>?apelido=SEU_NOME</code> ou o link direto do WhatsApp já com seu apelido.</p>
          <div id="linksOut" class="aff-result"></div>
        </div>
        <div class="aff-box">
          <label>Como funciona?</label>
          <p class="mini">
            • Quem entrar com o seu <b>?apelido=</b> verá os botões de WhatsApp identificados com você.<br>
            • Os botões dos planos abrem o WhatsApp com o plano + seu apelido (se estiver na URL).
          </p>
          <button class="btn btn-outline" onclick="copiarUltimo()">Copiar último link gerado</button>
        </div>
      </div>
    </section>

    <!-- PLANOS -->
    <section class="section">
      <h2>Planos ConectPlay</h2>
      <div class="plans">
        <div class="plan">
          <h3>15 dias de uso</h3>
          <div class="price">R$ 14,99</div>
          <ul class="features"><li>Teste rápido</li><li>Filmes, séries e canais ao vivo</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Plano 15 dias - R$14,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Mensal (1 acesso)</h3>
          <div class="price">R$ 20,99</div>
          <ul class="features"><li>HD/Full HD</li><li>Suporte rápido</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Mensal 1 acesso - R$20,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Mensal (2 acessos)</h3>
          <div class="price">R$ 25,99</div>
          <ul class="features"><li>2 dispositivos</li><li>TV ao vivo e VOD</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Mensal 2 acessos - R$25,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Bimestral (1 acesso)</h3>
          <div class="price">R$ 41,99</div>
          <ul class="features"><li>Economia no período</li><li>Suporte via WhatsApp</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Bimestral 1 acesso - R$41,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Bimestral (2 acessos)</h3>
          <div class="price">R$ 43,99</div>
          <ul class="features"><li>2 dispositivos</li><li>Filmes e séries</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Bimestral 2 acessos - R$43,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Trimestral (1 acesso)</h3>
          <div class="price">R$ 74,99</div>
          <ul class="features"><li>Custo/benefício</li><li>Atualizações constantes</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Trimestral 1 acesso - R$74,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Trimestral (2 acessos)</h3>
          <div class="price">R$ 76,99</div>
          <ul class="features"><li>2 dispositivos</li><li>On-demand + ao vivo</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Trimestral 2 acessos - R$76,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Semestral (1 acesso)</h3>
          <div class="price">R$ 149,99</div>
          <ul class="features"><li>6 meses de economia</li><li>Suporte prioritário</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Semestral 1 acesso - R$149,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Semestral (2 acessos)</h3>
          <div class="price">R$ 153,99</div>
          <ul class="features"><li>2 dispositivos</li><li>Atendimento dedicado</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Semestral 2 acessos - R$153,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Anual (1 acesso)</h3>
          <div class="price">R$ 297,99</div>
          <ul class="features"><li>Plano mais econômico</li><li>Atualizações constantes</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Anual 1 acesso - R$297,99')">Falar no WhatsApp</button>
        </div>
        <div class="plan">
          <h3>Anual (2 acessos)</h3>
          <div class="price">R$ 299,99</div>
          <ul class="features"><li>2 dispositivos</li><li>Suporte rápido</li></ul>
          <button class="btn btn-primary" onclick="abrirWhats('Anual 2 acessos - R$299,99')">Falar no WhatsApp</button>
        </div>
      </div>
      <p class="mini" style="margin-top:10px">Todos os planos contam com <b>teste grátis</b>.</p>
    </section>

    <!-- LISTA DE AFILIADOS (planilha com colunas Apelido, Quantidade) -->
    <section class="section">
      <h2>Afiliados</h2>
      <div class="mini">Lista carregada da sua planilha (Apelido e Quantidade).</div>
      <div style="overflow:auto; margin-top:10px">
        <table id="tAfiliados">
          <thead><tr><th>Apelido</th><th>Quantidade</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

  </div>

  <footer>
    <div>
      <a href="./politica-de-privacidade.html">Política de Privacidade</a> •
      <a href="./termos-de-servico.html">Termos de Serviço</a>
    </div>
    <div style="margin-top:6px">&copy; 2025 ConectPlay. Todos os direitos reservados.</div>
  </footer>

  <!-- PapaParse local; se falhar, carrega CDN -->
  <script src="js/papaparse.min.js" onerror="
    var s=document.createElement('script');
    s.src='https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js';
    document.head.appendChild(s);
  "></script>

  <script>
    const WHATS = '5577991986049'; // +55 77 99198-6049
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRVxgmYQsCQMXj4hycv10FMS8vNm1CF3EXgbyz2yVE-_ljhsPMmv0HOppUlYnMUejkuVcErojpLchgF/pub?output=csv';

    // util: pegar parâmetro da URL
    function getParam(n){ const u=new URL(location.href); return (u.searchParams.get(n)||'').trim(); }
    const apelidoAtivo = getParam('apelido');

    // mostra barra e preenche input se veio com ?apelido=
    (function(){
      if(!apelidoAtivo) return;
      const bar = document.getElementById('affBar');
      bar.textContent = `Você está com o afiliado: ${apelidoAtivo}`;
      bar.style.display = 'block';
      const ipt = document.getElementById('apelido');
      if(ipt && !ipt.value) ipt.value = apelidoAtivo;
    })();

    // gerar links do afiliado
    let ultimoLink = '';
    function gerarLinks(){
      const ap = (document.getElementById('apelido').value||'').trim();
      const out = document.getElementById('linksOut');
      if(!ap){ out.innerHTML = `<span class="mini">Digite um apelido.</span>`; return; }

      const linkSite = `${location.origin}${location.pathname}?apelido=${encodeURIComponent(ap)}`;
      const msg = `Ol%C3%A1%2C+vim+atrav%C3%A9s+do+afiliado+${encodeURIComponent(ap)}+e+quero+saber+os+planos+da+ConectPlay.%20Pode%20me%20ajudar%3F`;
      const linkZap  = `https://wa.me/${WHATS}?text=${msg}`;

      ultimoLink = linkZap;
      out.innerHTML = `
        <p><b>Link do seu site:</b><br><a href="${linkSite}" target="_blank">${linkSite}</a></p>
        <p><b>Link direto do WhatsApp:</b><br><a href="${linkZap}" target="_blank">${linkZap}</a></p>
      `;
    }
    function copiarUltimo(){
      if(!ultimoLink){ alert('Gere um link primeiro.'); return; }
      navigator.clipboard.writeText(ultimoLink).then(()=>alert('Link copiado!'));
    }

    // abrir WhatsApp com plano + afiliado (se houver)
    function abrirWhats(plano){
      const ap = apelidoAtivo || (document.getElementById('apelido').value||'').trim();
      const base = `Olá, quero saber mais sobre o plano: ${plano}.`;
      const plus = ap ? ` Vim através do afiliado ${ap}.` : '';
      const text = encodeURIComponent(base + plus);
      window.open(`https://wa.me/${WHATS}?text=${text}`, '_blank');
    }

    // carregar afiliados da planilha CSV
    function carregarAfiliados(){
      if(!window.Papa){ return setTimeout(carregarAfiliados, 400); }
      Papa.parse(CSV_URL, {
        download:true, header:true,
        complete: function(res){
          const TB = document.querySelector('#tAfiliados tbody');
          TB.innerHTML = '';
          const rows = (res.data||[])
            .filter(r => r.Apelido && r.Quantidade)
            .map(r => ({a:r.Apelido.trim(), q:Number(String(r.Quantidade).replace(',','.'))||0}));
          rows.sort((x,y)=> y.q - x.q);
          rows.forEach(r=>{
            const tr=document.createElement('tr');
            tr.innerHTML = `<td>${r.a}</td><td>${r.q}</td>`;
            TB.appendChild(tr);
          });
        },
        error: function(){
          document.querySelector('#tAfiliados tbody').innerHTML =
            `<tr><td colspan="2">Não foi possível carregar a planilha. Verifique o link CSV.</td></tr>`;
        }
      });
    }
    carregarAfiliados();
  </script>
</body>
</html>
